<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Benyamin Batau App - Sparkplug Diagnosis</title>
    <style>
        :root { --gold: #fbbf24; --accent: #2563eb; --bg: #0f172a; --card: #1e293b; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 400px; background: var(--card); padding: 25px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.5); text-align: center; border: 1px solid #334155; }
        h1 { font-size: 1.5rem; color: var(--gold); margin: 0; text-transform: uppercase; }
        h2 { font-size: 0.85rem; color: #94a3b8; margin: 5px 0 25px 0; font-weight: 400; letter-spacing: 0.5px; }
        #preview-box { width: 100%; height: 280px; background: #0f172a; border: 2px dashed #475569; border-radius: 20px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; overflow: hidden; position: relative; }
        #preview-img { max-width: 100%; max-height: 100%; display: none; object-fit: contain; }
        .btn-camera { background: var(--gold); color: #000; padding: 18px; border-radius: 15px; font-weight: 800; cursor: pointer; display: block; margin-bottom: 15px; transition: 0.3s; border: none; width: 100%; font-size: 1rem; }
        .btn-analyze { background: var(--accent); color: white; padding: 18px; border-radius: 15px; font-weight: 800; cursor: pointer; width: 100%; border: none; display: none; font-size: 1rem; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4); }
        #loading { display: none; margin: 20px 0; color: var(--gold); font-weight: bold; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        #result-box { margin-top: 25px; padding: 20px; background: #0f172a; border-radius: 15px; text-align: left; display: none; border-left: 6px solid var(--gold); line-height: 1.6; }
        .footer { margin-top: 25px; font-size: 0.75rem; color: #64748b; border-top: 1px solid #334155; padding-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>BENYAMIN BATAU APP</h1>
    <h2>Sparkplug Diagnosis TSM SMKN 1 Sumarorong</h2>

    <div id="preview-box">
        <span id="label-info" style="color: #475569; font-size: 0.9rem;">Belum ada foto busi</span>
        <img id="preview-img" src="">
    </div>

    <input type="file" id="camera-input" accept="image/*" capture="camera" style="display: none;">
    <button class="btn-camera" onclick="document.getElementById('camera-input').click()">AMBIL FOTO BUSI</button>
    
    <button id="btn-run" class="btn-analyze" onclick="mulaiDiagnosa()">MULAI ANALISIS AI</button>

    <div id="loading">âš¡ AI SEDANG MENGANALISIS...</div>

    <div id="result-box">
        <strong style="color: var(--gold); font-size: 1rem;">HASIL DIAGNOSA TEKNIS:</strong>
        <p id="hasil-teks" style="font-size: 0.95rem; margin-top: 10px; color: #e2e8f0;"></p>
    </div>

    <div class="footer">
        Dibuat untuk Praktikum Jurusan TSM<br>
        <strong>SMKN 1 SUMARORONG</strong>
    </div>
</div>

<script>
    // API KEY SUDAH TERPASANG
    const API_KEY = "AIzaSyDcqCfYvtp2D7Y-LLYr9kTAElIOy0K_2JI"; 
    const URL_GEMINI = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;

    const inp = document.getElementById('camera-input');
    const img = document.getElementById('preview-img');
    const btn = document.getElementById('btn-run');
    const label = document.getElementById('label-info');

    inp.onchange = function() {
        const file = this.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                img.src = e.target.result;
                img.style.display = 'block';
                label.style.display = 'none';
                btn.style.display = 'block';
                document.getElementById('result-box').style.display = 'none';
            }
            reader.readAsDataURL(file);
        }
    };

    async function mulaiDiagnosa() {
        const base64Data = img.src.split(',')[1];
        const loader = document.getElementById('loading');
        const resBox = document.getElementById('result-box');
        const resText = document.getElementById('hasil-teks');

        loader.style.display = 'block';
        btn.style.display = 'none';

        const instruksi = "Kamu adalah ahli mekanik motor senior. Analisis foto busi ini. Berikan warna HEX dominan dari insulator, jelaskan kondisi pembakaran mesin (apakah normal, terlalu irit, atau bocor oli), dan berikan saran perbaikan singkat untuk siswa jurusan TSM SMK.";

        try {
            const respons = await fetch(URL_GEMINI, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{ parts: [{ text: instruksi }, { inline_data: { mime_type: "image/jpeg", data: base64Data } }] }]
                })
            });

            const hasilJSON = await respons.json();
            const jawaban = hasilJSON.candidates[0].content.parts[0].text;

            resText.innerText = jawaban;
            resBox.style.display = 'block';
        } catch (err) {
            resText.innerText = "Maaf, sistem sibuk atau API Key bermasalah. Pastikan internet aktif.";
            resBox.style.display = 'block';
        } finally {
            loader.style.display = 'none';
        }
    }
</script>

</body>
</html>
